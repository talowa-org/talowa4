// Post Menu Widget - Context menu for post actions\n// Part of Task 6: Implement PostWidget for individual posts\n\nimport 'package:flutter/material.dart';\nimport '../../models/social_feed/post_model.dart';\nimport '../../core/theme/app_theme.dart';\n\nclass PostMenuWidget extends StatelessWidget {\n  final PostModel post;\n  final VoidCallback? onEdit;\n  final VoidCallback? onDelete;\n  final VoidCallback? onReport;\n  final VoidCallback? onPin;\n  final VoidCallback? onHide;\n  final VoidCallback? onCopyLink;\n  final VoidCallback? onBookmark;\n\n  const PostMenuWidget({\n    super.key,\n    required this.post,\n    this.onEdit,\n    this.onDelete,\n    this.onReport,\n    this.onPin,\n    this.onHide,\n    this.onCopyLink,\n    this.onBookmark,\n  });\n\n  @override\n  Widget build(BuildContext context) {\n    return PopupMenuButton<String>(\n      icon: Icon(\n        Icons.more_vert,\n        color: Colors.grey[600],\n      ),\n      onSelected: (value) => _handleMenuAction(context, value),\n      itemBuilder: (context) => _buildMenuItems(context),\n    );\n  }\n\n  List<PopupMenuEntry<String>> _buildMenuItems(BuildContext context) {\n    final List<PopupMenuEntry<String>> items = [];\n    \n    // Check if current user is the author\n    final bool isAuthor = _isCurrentUserAuthor();\n    final bool isCoordinator = _isCurrentUserCoordinator();\n    \n    if (isAuthor) {\n      // Author actions\n      items.addAll([\n        _buildMenuItem(\n          value: 'edit',\n          icon: Icons.edit,\n          title: 'Edit Post',\n          enabled: onEdit != null,\n        ),\n        _buildMenuItem(\n          value: 'delete',\n          icon: Icons.delete,\n          title: 'Delete Post',\n          enabled: onDelete != null,\n          isDestructive: true,\n        ),\n        const PopupMenuDivider(),\n      ]);\n    }\n    \n    if (isCoordinator) {\n      // Coordinator actions\n      items.addAll([\n        _buildMenuItem(\n          value: 'pin',\n          icon: post.isPinned ? Icons.push_pin_outlined : Icons.push_pin,\n          title: post.isPinned ? 'Unpin Post' : 'Pin Post',\n          enabled: onPin != null,\n        ),\n        _buildMenuItem(\n          value: 'hide',\n          icon: post.isHidden ? Icons.visibility : Icons.visibility_off,\n          title: post.isHidden ? 'Show Post' : 'Hide Post',\n          enabled: onHide != null,\n        ),\n        const PopupMenuDivider(),\n      ]);\n    }\n    \n    // Common actions\n    items.addAll([\n      _buildMenuItem(\n        value: 'bookmark',\n        icon: Icons.bookmark_border,\n        title: 'Save Post',\n        enabled: onBookmark != null,\n      ),\n      _buildMenuItem(\n        value: 'copy_link',\n        icon: Icons.link,\n        title: 'Copy Link',\n        enabled: onCopyLink != null,\n      ),\n      const PopupMenuDivider(),\n      _buildMenuItem(\n        value: 'report',\n        icon: Icons.flag,\n        title: 'Report Post',\n        enabled: onReport != null && !isAuthor,\n        isDestructive: true,\n      ),\n    ]);\n    \n    return items;\n  }\n\n  PopupMenuItem<String> _buildMenuItem({\n    required String value,\n    required IconData icon,\n    required String title,\n    bool enabled = true,\n    bool isDestructive = false,\n  }) {\n    return PopupMenuItem<String>(\n      value: value,\n      enabled: enabled,\n      child: Row(\n        children: [\n          Icon(\n            icon,\n            size: 20,\n            color: isDestructive \n                ? Colors.red \n                : enabled \n                    ? Colors.grey[700] \n                    : Colors.grey[400],\n          ),\n          const SizedBox(width: 12),\n          Text(\n            title,\n            style: TextStyle(\n              color: isDestructive \n                  ? Colors.red \n                  : enabled \n                      ? Colors.grey[700] \n                      : Colors.grey[400],\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n\n  void _handleMenuAction(BuildContext context, String action) {\n    switch (action) {\n      case 'edit':\n        onEdit?.call();\n        break;\n      case 'delete':\n        _showDeleteConfirmation(context);\n        break;\n      case 'report':\n        _showReportDialog(context);\n        break;\n      case 'pin':\n        onPin?.call();\n        break;\n      case 'hide':\n        onHide?.call();\n        break;\n      case 'copy_link':\n        _copyPostLink(context);\n        break;\n      case 'bookmark':\n        onBookmark?.call();\n        break;\n    }\n  }\n\n  void _showDeleteConfirmation(BuildContext context) {\n    showDialog(\n      context: context,\n      builder: (context) => AlertDialog(\n        title: const Text('Delete Post'),\n        content: const Text(\n          'Are you sure you want to delete this post? This action cannot be undone.',\n        ),\n        actions: [\n          TextButton(\n            onPressed: () => Navigator.pop(context),\n            child: const Text('Cancel'),\n          ),\n          TextButton(\n            onPressed: () {\n              Navigator.pop(context);\n              onDelete?.call();\n            },\n            style: TextButton.styleFrom(\n              foregroundColor: Colors.red,\n            ),\n            child: const Text('Delete'),\n          ),\n        ],\n      ),\n    );\n  }\n\n  void _showReportDialog(BuildContext context) {\n    String? selectedReason;\n    final List<String> reportReasons = [\n      'Inappropriate content',\n      'Spam or misleading',\n      'Harassment or bullying',\n      'False information',\n      'Copyright violation',\n      'Other',\n    ];\n\n    showDialog(\n      context: context,\n      builder: (context) => StatefulBuilder(\n        builder: (context, setState) => AlertDialog(\n          title: const Text('Report Post'),\n          content: Column(\n            mainAxisSize: MainAxisSize.min,\n            crossAxisAlignment: CrossAxisAlignment.start,\n            children: [\n              const Text(\n                'Why are you reporting this post?',\n                style: TextStyle(fontWeight: FontWeight.w500),\n              ),\n              const SizedBox(height: 16),\n              ...reportReasons.map((reason) => RadioListTile<String>(\n                title: Text(reason),\n                value: reason,\n                groupValue: selectedReason,\n                onChanged: (value) {\n                  setState(() {\n                    selectedReason = value;\n                  });\n                },\n                activeColor: AppTheme.talowaGreen,\n                contentPadding: EdgeInsets.zero,\n              )),\n            ],\n          ),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('Cancel'),\n            ),\n            TextButton(\n              onPressed: selectedReason != null\n                  ? () {\n                      Navigator.pop(context);\n                      onReport?.call();\n                      _showReportConfirmation(context);\n                    }\n                  : null,\n              style: TextButton.styleFrom(\n                foregroundColor: Colors.red,\n              ),\n              child: const Text('Report'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  void _showReportConfirmation(BuildContext context) {\n    ScaffoldMessenger.of(context).showSnackBar(\n      const SnackBar(\n        content: Text('Post reported. Thank you for helping keep our community safe.'),\n        backgroundColor: Colors.green,\n      ),\n    );\n  }\n\n  void _copyPostLink(BuildContext context) {\n    // TODO: Implement actual link copying\n    ScaffoldMessenger.of(context).showSnackBar(\n      const SnackBar(\n        content: Text('Post link copied to clipboard'),\n        backgroundColor: Colors.green,\n      ),\n    );\n    onCopyLink?.call();\n  }\n\n  bool _isCurrentUserAuthor() {\n    // TODO: Check if current user is the post author\n    // This would typically check against the current user's ID\n    return false; // Placeholder\n  }\n\n  bool _isCurrentUserCoordinator() {\n    // TODO: Check if current user has coordinator privileges\n    // This would check the user's role\n    return false; // Placeholder\n  }\n}\n\n// Quick action buttons for common post actions\nclass PostQuickActions extends StatelessWidget {\n  final PostModel post;\n  final VoidCallback? onLike;\n  final VoidCallback? onComment;\n  final VoidCallback? onShare;\n  final VoidCallback? onBookmark;\n\n  const PostQuickActions({\n    super.key,\n    required this.post,\n    this.onLike,\n    this.onComment,\n    this.onShare,\n    this.onBookmark,\n  });\n\n  @override\n  Widget build(BuildContext context) {\n    return Row(\n      children: [\n        _buildQuickActionButton(\n          icon: post.isLikedByCurrentUser \n              ? Icons.favorite \n              : Icons.favorite_border,\n          label: _formatCount(post.likesCount),\n          onTap: onLike,\n          isActive: post.isLikedByCurrentUser,\n          activeColor: Colors.red,\n        ),\n        \n        const SizedBox(width: 16),\n        \n        _buildQuickActionButton(\n          icon: Icons.comment_outlined,\n          label: _formatCount(post.commentsCount),\n          onTap: onComment,\n        ),\n        \n        const SizedBox(width: 16),\n        \n        _buildQuickActionButton(\n          icon: Icons.share_outlined,\n          label: _formatCount(post.sharesCount),\n          onTap: onShare,\n        ),\n        \n        const Spacer(),\n        \n        _buildQuickActionButton(\n          icon: Icons.bookmark_border,\n          onTap: onBookmark,\n        ),\n      ],\n    );\n  }\n\n  Widget _buildQuickActionButton({\n    required IconData icon,\n    String? label,\n    VoidCallback? onTap,\n    bool isActive = false,\n    Color? activeColor,\n  }) {\n    return GestureDetector(\n      onTap: onTap,\n      child: Row(\n        mainAxisSize: MainAxisSize.min,\n        children: [\n          Icon(\n            icon,\n            size: 20,\n            color: isActive \n                ? (activeColor ?? AppTheme.talowaGreen)\n                : Colors.grey[600],\n          ),\n          if (label != null) ...[\n            const SizedBox(width: 4),\n            Text(\n              label,\n              style: TextStyle(\n                fontSize: 12,\n                color: isActive \n                    ? (activeColor ?? AppTheme.talowaGreen)\n                    : Colors.grey[600],\n              ),\n            ),\n          ],\n        ],\n      ),\n    );\n  }\n\n  String _formatCount(int count) {\n    if (count >= 1000000) {\n      return '${(count / 1000000).toStringAsFixed(1)}M';\n    } else if (count >= 1000) {\n      return '${(count / 1000).toStringAsFixed(1)}K';\n    } else {\n      return count.toString();\n    }\n  }\n}"